---
title: Bumblebee occupancy responds to complex interactions between local and landscape land use, climatic niche properties and climate change
author: "Tim Newbold^1,\\*^, Jeremy Kerr^2^, Peter Soroye^2,&dagger;^, Jessica J. Williams^1^"
output:
  bookdown::word_document2:
    toc: false
    fig_caption: TRUE
    number_sections: no
always_allow_html: true
csl: ecology-letters.csl
bibliography: bumblebees_lu_cc_refs.bib
---

^1^Centre for Biodiversity and Environment Research, Department of Genetics, Evolution and Environment, University College London, London, UK

^2^Department of Biology, University of Ottawa, Ottawa, Ontario, Canada

^&dagger;^Current address: Wildlife Conservation Society Canada, Toronto, Ontario, Canada

^\*^Correspondence: Tim Newbold, Centre for Biodiversity & Environment Research, Department of Genetics, Evolution & Environment, University College London, Gower Street, London WC1E 6BT, United Kingdom; Email: [t.newbold@ucl.ac.uk](mailto:t.newbold@ucl.ac.uk); Tel: +44(0)2031087569

**Short title:** Land-use-climate interactions and bumblebees

**Keywords:** Bumblebees, Climate change, Fertilizer, Land use, Natural habitat, Occupancy, Pesticide, Pressure interactions, Thermal niche

**Type of article:** Letter

**Authorship statement:** TN, JK, PS and JJW designed the analyses. TN performed all main analyses. TN and PS provided the methods for quantifying species' thermal niche position. TN wrote the first draft of the manuscript. All authors contributed to editing the manuscript. TN and JK secured the funding to support the presented research.

**Number of words in abstract:** 150

**Number of words in main text (excluding abstract, acknowledgments, references, and table and figure legends):** 5,436

**Number of references:** 80

**Number of figures:** 6

**Number of tables:** 1

<!-- SETUP: Global options -->
```{r setup,echo=FALSE,results=FALSE}
knitr::opts_chunk$set
options(scipen=20)
```

\newpage

# Abstract

Insect biodiversity is changing rapidly, driven by a complex suite of pressures, notably land use, land-use intensification, and increasingly climate change. Bumblebees pollinate wild plants and crops, but we lack large-scale evidence on how land use and climate change interact to drive bumblebee biodiversity changes. We assess bumblebee responses to interactive effects of land use and climate pressures across North America and Western Europe. Occupancy increases with landscape natural habitat and in landscapes more recently disturbed by humans. Responses to historical climate warming are negative in natural habitats but positive in human land uses, while human land use reduces occupancy most in the centre of species’ temperature niches. We estimate that the combined pressures have reduced bumblebee occupancy by 61% across sampled natural habitats, and 65% across human land uses. Our results can inform efforts to conserve bumblebee biodiversity in the face of ongoing land-use changes and accelerating climatic changes.

\newpage

# Introduction

Insect biodiversity has been undergoing rapid changes in recent decades, although reported trends differ in direction and magnitude. Several studies have suggested steep declines in the abundance, richness and distributions of terrestrial insect species, including bumblebees [@Kerr2015; @Lister2018; @Soroye2020; @vanKlink2020; @Janousek2023]. On the other hand, other studies have suggested a more mixed picture, with little overall change in insect biodiversity on average [@Outhwaite2020; @Macgregor2019]. Biodiversity changes, including those of insects, are often characterized by strong turnover, with certain species - or groups of species - showing more positive trends than others [@Outhwaite2020; @Kammerer2021; @Halsch2021; @Wagner2021].

Human land use and land-use intensification have been identified as key drivers of insect biodiversity changes. In general, previous studies have demonstrated a negative effect on bees (including bumblebees) of the conversion of natural habitats to agriculture and other human-modified habitats [@DePalma2017; @Evans2018; @Samuelson2018; @Janousek2023], although responses vary strongly among species [@Prestele2021; @Cariveau2013] and among regions [@DePalma2016]. Furthermore, within agricultural areas, intensification of farming practices (e.g. lowering of crop diversity, or the removal of flower-rich field margins) is associated with further reductions, on average, in bee diversity [@Hemberger2021; @Kennedy2013]. One facet of agricultural intensification that is of particular importance for bees is the increased application of chemical pesticides, which has been associated with reductions in bee distributions, population persistence, and reproductive performance [@Stuligross2021; @Woodcock2016; @McArt2017; @Siviter2021; @Whitehorn2012], although effects vary spatially [@Woodcock2017]. 

The effects of land use and habitat differences can operate on larger spatial and temporal scales than captured at the location and time of biodiversity sampling. The availability of natural or semi-natural habitats in the landscape has been shown to be important for sustaining the diversity of bees, as well as improving individual and colony performance, including in agricultural habitats [@Evans2018; @Mola2021; @Rutschmann2022; @Proesmans2019; @GutierrezChacon2018]. However, effects often depended on the species and/or the nature of the natural habitat [@Kammerer2021; @Goulson2010; @GutierrezChacon2018], and sometimes were absent or negative, for example when farmed areas provide abundant floral resources [@Christman2022; @Mola2021]. At the same time, farming practices within agricultural land uses may impact biodiversity within natural habitats. For example, pesticides and other agricultural chemicals may disperse out of the farmland in which they are applied [@vanDerWerf1996], and so could impact insect biodiversity across all habitats in a landscape. Similarly, over time, agricultural landscapes tend to become progressively intensified, becoming more homogeneous and losing remnant natural habitats [@Tscharntke2005]. Thus, we might expect landscapes that have been farmed for longer to contain a lower diversity of bees and other insects.

Climate change is already exerting a strong influence on patterns of bee and bumblebee biodiversity, and its effect is likely to grow rapidly in the coming years. Already, bumblebee distributions have been contracting at the southern range margin [@Kerr2015] and moving to higher elevations [@Pyke2016], while the Community Temperature Index of bumblebee communities (which measures the average temperature affiliation of species in a community) has been increasing [@Fourcade2019], consistent with expectations under climate warming. Indeed, analyses of changes in bee diversity over time have revealed an important role for warming temperatures in observed declines [@Kammerer2021; @Soroye2020; @Janousek2023], and have revealed larger declines in more climatically specialized species [@Williams2009]. Experimental exposure of bumblebees to heat stress led to high rates of mortality in bumblebee species [@Martinet2021]. Future projections suggest that the impact of climate change on bumblebees is likely to increase in the coming decades [@Prestele2021; @Marshall2018].

Recent evidence points toward synergistic interactive effects of land use, land-use intensification and climate change on biodiversity, but only a small number of studies have focused on insects [@Oliver2017; @Hamblin2017; @Waldock2020; @Outhwaite2022]. These interactive effects are driven by two key mechanisms. First, habitat disturbance impedes species shifting their ranges in response to climate change [@Oliver2014]. Second, conversion of natural habitats to agriculture and other human uses changes local climates, typically towards hotter and drier conditions with greater extremes of temperature [@Oliver2014; @Williams2020]. For insects in general, the coincidence of intensive agricultural land use and rapid recent climate change is associated with reductions of around 50% of total assemblage abundance, with the greatest losses occurring where little natural habitat remains in the landscape [@Outhwaite2022]. Insect species tolerant of warmer and drier conditions, on average, tend to be favoured in agricultural and urban land uses [@Oliver2017; @Hamblin2017; @Waldock2020], probably as a result of the altered local climatic conditions in these areas. Studies on vertebrates have revealed that populations living close to the upper realized temperature niche of species respond more negatively to human land uses than populations living elsewhere [@Williams2021].

Bumblebees are a key group of species, of high importance for both natural ecosystems and agricultural production. Half of plant species are estimated to depend on wild animal pollinators for more than 80% of their seed production [@Rodger2021]. Lower pollinator biodiversity has been shown to reduce the reproductive success of wild plants [@Albrecht2012], and greater rates of declines of plants that depend on animal pollination than other plant species may be associated with declines in key pollinator species [@Biesmeijer2006]. Many studies have shown positive relationships between pollinator diversity and measures of crop success [@Woodcock2019; @Garibaldi2013; @Dainese2019; @Klein2003; @Lemanski2022]. As 'buzz' pollinators [@Pritchard2020], which use vibrations to dislodge pollen from flowers and play a vital role in the pollination of certain plant species, bumblebees make a substantial contribution to the pollination of many important crops, including apples, pears, melons, peppers, cucumbers, tomatoes, and many nuts and soft fruits [@Klein2007].

Here we present a continental-scale study that simultaneously considers the interacting effects of climate change, land use and land-use intensification on bumblebee species' occupancy. Despite there being numerous studies on the impact of individual pressures on bees, bumblebees and other insects, continental-scale studies remain rare, and there have been no large-scale studies assessing bumblebee responses to interacting effects of climate and land-use-related pressures. We study the impact of land-use-climate interactions on bumblebees across the continents of North America and Europe. Specifically, we test the response of bumblebee occupancy to five classes of environmental variables: land use (natural habitat versus agricultural areas), land-use intensity (application rates of pesticides and fertilizer), land-use history, landscape natural habitat availability, and climate-related variables (population position within species' realized temperature niche, and change in this niche position caused by recent climate change). We hypothesize that bumblebee occupancy will be lower in agricultural areas, particularly where land-use intensity is higher, where landscapes have been dominated by human activities for longer, and where less natural habitat remains within the landscape. We further hypothesize that occupancy will be most strongly reduced in agricultural land use for populations near the upper limit of species' temperature niche, and especially where there have been recent increases in temperature. Because the analysed data consist of snapshot spatial comparisons of biodiversity among different habitats, mostly sampled between 2000 and 2013, biodiversity may already have been reduced within natural habitats as a result of historic human pressures (leading to a 'shifting baseline syndrome' [@Pauly1995]). To test for such impacts, we use our models, which describe responses to multiple interacting pressures, to infer how bumblebee occupancy has been altered across sampled habitats, both natural and human-modified.

# Material and Methods

## Data on Responses to Land Use

<!-- SUMMARY STATISTICS: data summaries -->
```{r summarize_data,echo=FALSE,warning=FALSE,results=FALSE}
# Set input directories
dataDir <- "2_PrepareDiversityData/"
modelsDir <- "3_RunModels/"

# Load the compiled species-level data
diversity <- readRDS(paste0(dataDir,"diversity_data.rds"))

allData <- readRDS(paste0(modelsDir,"ModelData.Rds"))

sites <- readRDS(paste0(modelsDir,"AnalysisSites.rds"))

n.studies <- format(length(unique(allData$SS)),big.mark=",",scientific=FALSE)
n.records <- format(nrow(allData),big.mark=",",scientific=FALSE)
n.species <- format(length(unique(allData$Best_guess_binomial)),big.mark=",",
                    scientific=FALSE)
n.countries <- format(length(unique(allData$Country)),big.mark=",",
                      scientific=FALSE)

countries <- unique(allData$Country)

# Put countries in more logical order
countries2 <- na.omit(countries[c(5,1,6,4,10,7,11,13,8,12,9,2,3)])

# Create text string
countries2 <- paste(countries2,collapse=", ")

# Replace last comma with 'and'
countries2 <- sub(",([^,]*)$", " and\\1", countries2)

n.sites <- format(nrow(sites),big.mark=",",scientific=FALSE)

# Get sample years
diversity$SampleYearMid <- as.integer(
  sapply(X = paste(diversity$Sample_midpoint),
         FUN = function(x) strsplit(x,'-')[[1]][1]))

first.year <- min(diversity$SampleYearMid)
last.year <- max(diversity$SampleYearMid)
```

Data describing the occurrence of bumblebees in different land-use types were derived from the PREDICTS database [@Hudson2017]. The PREDICTS database collates biodiversity records from individual studies that conducted snapshot spatial samples of biodiversity along land-use or land-use-intensity gradients [@Hudson2014]. Studies included in the database had to meet a number of criteria: 1) that the study, or at least its methods, were published; 2) that biodiversity was sampled at more than one location; 3) that the study considered the effect of human activities on a set of sampled taxa, with the level of human activity varying among sampled locations; and 4) that the sampling protocol was the same across sampled sites. Any records without geographical coordinates were omitted. In this study, we focused on the occurrence (i.e., simple presence or absence) of taxa that were identified to the species level.  

The final dataset that we used in this study were derived from `r n.studies` original studies, and consist of `r n.records` records for `r n.species` bumblebee species, collected across `r n.sites` sites in `r n.countries` different countries in North America, and Western, Northern and Southern Europe: `r na.omit(countries2)` (Figure S1). The original samples of bumblebees that were collated in the PREDICTS database were collected in the field between `r first.year` and `r last.year`.

## Explanatory Variables

We considered land use in our analysis by dividing sampled sites into either natural habitats or human-modified land. In the PREDICTS database, land use is classified into one of six broad categories: primary vegetation (natural habitat never having been recorded as being destroyed), secondary vegetation (habitat recovering to its natural state after being destroyed in the past by human actions or extreme natural events), plantation forests (areas used to cultivate woody crops), cropland (areas used to cultivate herbaceous crops, including as fodder for livestock), pasture (areas used regularly or permanently to graze livestock), and urban (areas of human settlement or other buildings, or areas managed for human recreation). We treated primary and secondary vegetation as natural habitats, and all other land-use types as human-modified.

We investigated how variables describing surrounding habitat conditions, land-use intensity (specifically, chemical application) and species' temperature niche properties shape the occupancy of bumblebees in both natural and human-modified habitats.

Information on habitat condition in the landscapes surrounding sampled sites comprised estimates of the availability of natural habitat, as well as the length of time that landscape habitat has been substantially modified by humans. Availability of surrounding natural habitats was measured as the percentage of natural habitat in the 5 &times; 5-km grid cell within which the biodiversity sample was taken. Original mapped estimates of different land-use types were from a down-scaled land-use projection for 2005 (the mid-point of original field sampling of data included in this analysis; see previous sub-section) at 30-arc-second spatial resolution (approximately 1 km at the Equator) [@Hoskins2016]. These land-use maps estimate the fraction of each grid cell covered by five out of the six land-use types recognised in the PREDICTS database: primary and secondary vegetation, cropland, pasture and urban. Following our classification of overall land-use type (see above), we summed the primary and secondary vegetation maps to obtain estimates of natural habitat. We projected and resampled this map of the fractional cover of natural habitat at 30-arc-second resolution to an equal-area grid (Behrmann projection) at 1-km resolution, using bilinear interpolation (implemented using the projectRaster function of the raster R package Version 3.5-29; [@Hijmans2021]). We then aggregated the resulting 1-km map by a factor of five, calculating the mean fractional cover of natural habitat for each 25-cell spatial cluster, yielding the final map at 5-km resolution. We derived estimates of the duration of substantial human habitat modification from a land-use reconstruction at 0.5° spatial resolution. Specifically, we used the reconstruction from the harmonized land-use estimates created for the fifth assessment report of the Intergovernmental Panel on Climate Change [@Hurtt2011]. The original historical land-use estimates used in this harmonization were from the HYDE model Version 3.1 [@Goldewijk2011]. The harmonized historical land-use estimates describe reconstructed changes in the fractional cover of primary vegetation, secondary vegetation, croplands, pastures and urban areas from 1500 to 2005. We measured the duration of substantial human habitat modification as the number of years since a 0.5° grid cell was first 30% converted to human-modified land-use types (croplands, pastures or urban areas). Grid cells that have never yet reached the conversion threshold of 30% are considered to have a duration of substantial landscape modification of 0 years. A 30% loss of natural habitats from landscapes is a level above which the most sensitive species are thought to be substantially negatively impacted [@Andren1994].

We considered the density (kg/ha) of application of two classes of chemicals: pesticides and fertilisers. We derived recent modelled estimates of pesticide application density across a 5-arc-minutes (approximately 10 km at the Equator) global spatial grid [@Maggi2019]. We used the low rather than high modelled estimates from this dataset, to be conservative, but tested the robustness of our models to using the high estimates instead. We obtained estimates of fertiliser application rates from global modelled estimates, also at 5-arc-minutes spatial resolution [@Mueller2012]. Estimates are available of total nitrogen, phosphorous and potassium application rates on each of 17 major global crops. We summed application rates for all three nutrients and all 17 crops to generate an estimate of total fertiliser application rate. 

For information on species temperature niche properties, we used previously published methods and associated records of bumblebee occupancy [@Soroye2020]. Specifically, we estimated: 1) the exposure of a species' population to extreme high temperatures relative to its realized temperature niche in a baseline period before the onset of rapid climate changes (1901 &mdash; 1975); and 2) the change in exposure caused by climate change between the baseline period and a more recent period (2000 &mdash; 2014). Realized temperature niche limits were estimated for each species as the mean of the five lowest minimum monthly temperatures and the maximum of the five highest maximum monthly temperatures across all bumblebee spatial records in the baseline period. To measure the exposure of each species' population to extreme high temperatures in either the baseline or recent period, we then derived the maximum monthly temperatures for all twelve months in each baseline or recent year. These maximum monthly temperatures were rescaled such that a value of 0 equates to the minimum realized temperature niche limit of the species, and a value of 1 to the maximum niche limit. We then averaged the 12 monthly values to derive an annual mean exposure. Finally, we averaged the annual exposure estimates across all years in either the baseline or recent period. Thus, we were able to estimate, for any biodiversity record, the average exposure to extreme high temperatures in the baseline period, or the change in exposure between the baseline and recent periods. Monthly minimum and maximum temperature estimates for the period 1901 to 2015 were obtained from the CRU global gridded climate reconstruction Version 3.24.01 [@CRU32401], which was the most recent version of this dataset available at the time the bumblebee climatic niche properties were estimated.

## Statistical Analysis

To analyse the presence or absence of bumblebee species at the sampled locations, we used binomial generalised linear mixed-effects models, to account for the hierarchical structure of the PREDICTS database. In all models, we used a binary response variable representing the presence or absence of each species at each sampled location. Species were considered absent if they were not recorded but had been targeted by a particular study (typically these species were sampled in at least one of the sites within each study). As random effects, we fitted: 1) Study identity, to control for differences in sampling protocols and broad geographic differences; 2) Site identity nested within study identity, to control for site-specific factors; and 3) Species identity, to account for variation in responses among species unrelated to variation in the environmental driver variables. Although there may be important differences between the two continents in average occupancy of bumblebees, as well as in responses to the considered explanatory variables, the size of the dataset and the fact that sampling was much less intensive in North America than Europe prevented the inclusion of such variation in the models.

We considered a candidate set of models with different fixed-effects structures. First, we fitted a null, intercept-only model. Second, a model with only land use as a fixed effect. Third, models fitting, as well as land use, all possible combinations of the different broad classes of explanatory variables (landscape habitat, land-use intensity, and climatic niche properties), and also interactions between these additional explanatory variables and land use (Table \@ref(tab:tablestats)). We assessed model fit to the data using AIC values. For each model $i$ in the set of models $I$, we calculated the difference in its AIC compared to the best-fitting model, $\Delta_i$, and the model AIC weight, $AIC_w$: 

$$AIC_w=\frac{e^{-\frac{1}{2}\Delta_i}}{\sum_{i=1}^{I}{(e^{-\frac{1}{2}\Delta_i})}}$$

We also calculated the sum of AIC weights of all models containing a particular class of explanatory variable. In addition to comparing the statistical support for models by comparing AIC values and AIC weights, we also estimated model explanatory power by computing pseudo R^2^ values following [@Nakagawa2013], conducted model diagnostic tests using the DHARMa package Version 0.4.5 in R [@DHARMa], and tested for spatial autocorrelation in the residuals associated with each underlying study using Moran's test, implemented in the spdep package Version 1.2-8.

To reveal the impacts that environmental changes to date have had on bumblebee biodiversity across both natural habitats and human-modified habitats, we used our final set of models to infer biodiversity changes across the sampled sites, based on the values of the model explanatory variables at those sites at the time of biodiversity sampling (or as close as possible - see above). These estimates thus included the impacts on both natural and modified habitats of climate change, and the modification of landscapes by human land use. Estimates of biodiversity at the time of sampling were expressed as a percentage difference compared to a baseline condition in which we assumed that landscapes were entirely composed of natural habitat, thus with no history of human modification, subject to no application of fertilizers and pesticides, and with no change in climate experienced. To derive model-estimated differences between baseline and contemporary conditions, we randomly generated 1,000 estimates of percentage difference to represent both model and parameter uncertainty. Thus, each estimate was generated by: 1) drawing at random from among the candidate models, weighted by their AIC weights (see above); 2) drawing a set of parameters from this chosen model based on a multivariate normal distribution, with means being the model-estimated coefficients, the standard deviation from the coefficient uncertainties, and parameter correlations derived from the variance-covariance matrix; 3) using these parameters to estimate average bumblebee probability of occurrence under baseline and contemporary environmental conditions; and 4) calculating the percentage difference in average occurrence probability between baseline and contemporary conditions.

# Results

<!-- PLOTTING: Setup for model results plots -->
```{r results_setup, echo=FALSE,warning=FALSE}
#### Model results plot - Setup ####

set.seed(1234)

# Set input directory
inDir <- "3_RunModels/"

# Load required packages
suppressMessages(suppressWarnings(library(StatisticalModels)))

# Log-transform elevation, which is very skewed
diversity$LogElevation <- log(diversity$Elevation+2)

# Log-transform fertilizer application, which is also very skewed
diversity$LogFertilizer <- log(diversity$Fertilizer+1)

diversity$UI <- paste(diversity$LandUse,diversity$Use_intensity,sep="_")
diversity$UI[grepl("Natural",diversity$UI)] <- "Natural"
diversity$UI[grepl("NA",diversity$UI)] <- NA
diversity$UI[grepl("Cannot decide",diversity$UI)] <- NA
diversity$UI <- factor(diversity$UI)
diversity$UI <- relevel(diversity$UI,ref="Natural")

# Select relevant columns
modelData <- diversity[,c('occur','LandUse','TEI_BL',
                          'TEI_delta','LogElevation','SS','SSBS',
                          'Taxon_name_entered','Longitude','Latitude',
                          'Best_guess_binomial','Country',
                          'Pesticide','LogFertilizer',
                          'NaturalHabitat','AgeConv')]
# Remove rows with any NA values
modelData <- na.omit(modelData)

# Load the final model
finalModels <- readRDS(paste(inDir,"FinalModels.rds",sep=""))
```

<!-- STATISTICS: Calculate AIC statistics for model reporting -->
```{r calc_stats,echo=FALSE,warning=FALSE}
# Load required packages
library(StatisticalModels)

# Calculate the delta AIC of the land-use-only model compared to the null model
lu.delta.aic <- round(AIC(finalModels[[2]]) - AIC(finalModels[[1]]),2)

# Extract the AIC values of all final models
aics <- unlist(lapply(finalModels,AIC))

# Calculate AIC differences for each model compared to the best-fitting model
aic.diffs <- aics - min(aics)

# Calculate the delta AIC of the best model compared to the null model
best.delta.aic <- round(min(aics) - aics[1],2)

# Calculate the AIC weights of each model
aic.weights <- (exp(-0.5*aic.diffs))/(sum(exp(-0.5*aic.diffs)))

# Specify the models that contain natural habitat variable
nathab.mods <- c(3,7,8,9,13,14,15,17)

# Calculate the sum of AIC weights of the models containing natural habitat variable
aic.wt.sum.nathab <- round(sum(aic.weights[nathab.mods]),2)

# Specify the models that contain land-use-intensity variables
# (Pesticide and fertilizer application)
intensity.mods <- c(4,7,10,11,13,14,16,17)

# Calculate the sum of AIC weights of the models containing land-use-intensity variables
aic.wt.sum.intensity <- round(sum(aic.weights[intensity.mods]),2)

# Specify the models that contain land-use-history variable
luhist.mods <- c(5,8,10,12,13,15,16,17)

# Calculate the sum of AIC weights of the models containing land-use-history variable
aic.wt.sum.luhist <- round(sum(aic.weights[luhist.mods]),2)

# Specify the models containing climatic variables
clim.mods <- c(6,9,11,12,14,15,16,17)

# Calculate the sum of AIC weights of the models containing climatic variables
aic.wt.sum.clim <- round(sum(aic.weights[clim.mods]),2)

# Get the pseudo-r-squared values of all models
r2.marginal <-unlist(lapply(finalModels,function(m) 
  return(R2GLMER(m)$marginal)))
r2.conditional <- unlist(lapply(finalModels,function(m) 
  return(R2GLMER(m)$conditional)))


# Get the pseudo-r-squared values of the most complex (and best-fitting) model
r2.complex.mod.cond <- round(R2GLMER(model = finalModels[[17]])$conditional,2)
r2.complex.mod.marg <- round(R2GLMER(model = finalModels[[17]])$marginal,3)

# Get the pseudo-r-squared values of the land-use-only model
r2.lu.mod.cond <- round(R2GLMER(model = finalModels[[2]])$conditional,2)
r2.lu.mod.marg <- round(R2GLMER(model = finalModels[[2]])$marginal,4)
```

Availability of natural habitat in the landscape, land-use intensity, land-use history, climatic niche properties and climate change all made a substantial contribution to explaining bumblebee occupancy across land uses (Table \@ref(tab:tablestats)). A model containing just land use was only marginally better than the null model (&Delta;AIC = `r lu.delta.aic`), and land use alone explained only a very small proportion of the variation in bumblebee occupancy (R^2^~marginal~ = `r r2.lu.mod.marg`; R^2^~conditional~ = `r r2.lu.mod.cond`; Table \@ref(tab:tablestats)). The most complex, and best-fitting model, containing all of the candidate fixed effects, showed a much better fit than the null model (&Delta;AIC = `r best.delta.aic`), and explained substantially more of the variation in bumblebee occupancy (R^2^~marginal~ = `r r2.complex.mod.marg`; R^2^~conditional~ = `r r2.complex.mod.cond`; Table \@ref(tab:tablestats)).

<!-- STATISTICS: AIC table -->
```{r tablestats,echo=FALSE,results=TRUE, tab.id = 'tablestats', tab.width=2}

library(flextable)

aic.table <- data.frame(
  "Model" = c("Null",
              "LU",
              "LU + NatHab",
              "LU + Intensity",
              "LU + LUHistory",
              "LU + Climate",
              "LU + NatHab + Intensity",
              "LU + NatHab + LUHistory",
              "LU + NatHab + Climate",
              "LU + Intensity + LUHistory",
              "LU + Intensity + Climate",
              "LU + LUHistory + Climate",
              "LU + NatHab + Intensity + LUHistory",
              "LU + NatHab + Intensity + Climate",
              "LU + NatHab + LUHistory + Climate",
              "LU + Intensity + LUHistory + Climate",
              "LU + NatHab + Intensity + LUHistory + Climate"),
  AIC = c(round(aics,0)),
  deltaAIC = c(round(aic.diffs,1)),
  Weight=c(round(aic.weights,2)),
  R2M = c(signif(r2.marginal,2)),
  R2C = c(signif(r2.conditional,2)))

aic.table.sub <- aic.table[c(1,2,13:17),]

rownames(aic.table.sub) <- NULL

ft <- flextable(aic.table.sub)

ft <- set_table_properties(x = ft,layout = 'autofit',align = 'center')

ft <- set_header_labels(x = ft,values = list(Model='Model',AIC='AIC',deltaAIC='deltaAIC',Weight='AIC Weight',R2M='R2M',R2C='R2C'))

ft <- set_caption(x = ft, caption = as_paragraph(as_b('Summary statistics of the candidate models'),'. Candidate models considered different combinations of variable categories: land use (LU), amount of natural habitat in the surrounding landscape (NatHab), land-use intensity variables (Intensity, consisting of rates of pesticide and fertilizer application), landscape history (LUHistory, specifically the duration of time since the landscape was substantially modified by human land uses) and climate-related variables (Climate, consisting of the realized temperature niche position in the baseline period (1901-1975) and the change in niche position between this baseline period and a more recent period (2000-2014). Statistics shown are: model AIC, the difference in AIC between the best model and the candidate model (deltaAIC), the AIC weight of the candidate model (Weight), and the marginal and conditional pseudo-R',as_sup('2'),' values of the candidate model (R2M and R2C, respectively)'))

ft
```


<!-- STATISTICS AND PLOTTING: Get modelled effects of land use -->
```{r preds_lu,echo=FALSE,warning=FALSE}

### Land use
# Create data frame with variable values for which to predict occurrence probability
# Start with rows for natural and human land use
nd <- data.frame(LandUse=factor(c("Natural","Human")))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# Set natural habitat, pesticide and landscape age variables at their median
# values for each land-use type
nd$NaturalHabitat <- c(
  median(modelData[modelData$LandUse=="Natural",]$NaturalHabitat),
  median(modelData[modelData$LandUse=="Human",]$NaturalHabitat))
nd$Pesticide <- c(
  median(modelData[modelData$LandUse=="Natural",]$Pesticide),
  median(modelData[modelData$LandUse=="Human",]$Pesticide))
nd$LogFertilizer <- c(
  median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
  median(modelData[modelData$LandUse=="Human",]$LogFertilizer))
nd$AgeConv <- c(
  median(modelData[modelData$LandUse=="Natural",]$AgeConv),
  median(modelData[modelData$LandUse=="Human",]$AgeConv))
# Set baseline TEI to be near range centre, the median of 
# sampled values (i.e. = 0.59)
nd$TEI_BL <- 0.59
# Set delta TEI to zero (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(model = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                       na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                       na.rm=TRUE))*100)-100

lu.human.loss.median <- -round(preds.median[2],1)
lu.human.loss.upper <- -round(preds.lower.95[2],1)
lu.human.loss.lower <- -round(preds.upper.95[2],1)

```

Bumblebee occupancy is on average `r lu.human.loss.median`% lower in areas of human land use compared to in natural habitat (95% confidence intervals: `r lu.human.loss.lower`% - `r lu.human.loss.upper`%), according to the final set of models considering all covariates (Figure \@ref(fig:figlu)). 

<!-- PLOTTING: Land-use effect -->
```{r figlu, echo=FALSE, warning=FALSE, fig.width=8.5, fig.height=6,out.width="50%", fig.cap="**Effect of land use on bumblebee probability of occurrence**. Values for human-modified habitat (i.e., agricultural and urban areas) are expressed as the % difference in probability of occurrence compared to natural (primary and secondary) habitats. All other variables are held at median values for the respective land use, except for baseline temperature niche position that is held at a fixed median value across both land-use types, and the change in temperature niche position owing to recent climate change that is held at zero. Points show the median prediction, while thick and thin error bars, respectively, represent the 67% and 95% confidence intervals. Predictions capture both model and parameter uncertainty, by drawing 1000 sets of estimates both across models (weighted by AIC weight), and within sampled models according to the modelled uncertainty in the parameter estimates"}

par(tck=-0.01)
par(mar=c(2.8,2.8,1.2,0.2))
par(mgp=c(1.8,0.2,0))
par(las=1)
par(cex=2)
par(cex.axis=1.3)
par(cex.lab=1.3)
par(cex.text=1.3)

# Plot error bars for 67% and 95% confidence intervals
errbar(x = 1:2,y = preds.median,yplus = preds.upper.95,yminus = preds.lower.95,
       pch=16,cap = 0,xaxt="n",xlim=c(0.6,2.4),lwd=1.5,cex = 1.6,bty="l",
       errbar.col = c("#009F81","#A40122"),col = c("#009F81","#A40122"),
       xlab=NA,ylab="P.occur difference (%)")
errbar(x = 1:2,y = preds.median,yplus = preds.upper.67,yminus = preds.lower.67,
       pch=16,cap = 0,xaxt="n",xlim=c(0.6,2.4),lwd=3.5,cex = 1.6,add = TRUE,
       errbar.col = c("#009F81","#A40122"),col = c("#009F81","#A40122"),
       xlab=NA,ylab="P.occur difference (%)")

axis(side = 1,at = c(1,2),labels = c("Natural","Human-modified"))
title(xlab="Land use")
abline(h=0,lty=2,col="#00000055")

```

The presence or absence of bumblebee species in both natural habitats and areas of human-modified land use is shaped strongly by habitat characteristics of the surrounding landscape. In both land-use types, bumblebees are more likely to occur in landscapes with more natural habitat and that have been dominated by humans for a shorter length of time, with the effect of natural habitat strongest in areas of human land use (Figure \@ref(fig:figlandscape)).

<!-- PLOTTING: Effects of landscape habitat and land-use history -->
```{r figlandscape, echo=FALSE, warning=FALSE, fig.width=17.5, fig.height=12,out.width="100%", fig.cap="**Effect of landscape-level land-use characteristics on bumblebee probability of occurrence across land uses**. Landscape characteristics considered were the percentage of natural habitat (A and B) and the duration of substantial human modification of the landscape (i.e., the number of years since 30% of the landscape was converted to human-modified habitats) (C and D). Modelled effects are shown for natural (primary and secondary) habitats (A and C) and for human-modified (agricultural and urban) habitats (B and D). All other variables are held at median values for the respective land use, except for baseline temperature niche position that is held at a fixed value across both land-use types of 0.59 (the 10th percentile of values in the original dataset, representing a position near the temperature niche centre), and the change in temperature niche position owing to recent climate change that is held at zero. Values are expressed as the % difference in probability of occurrence compared to natural habitat locally, in a landscape composed entirely of natural habitat, with no history of landscape modification, with no application of agricultural chemicals, and no recent climate change. Lines represent modelled median projections, while dark and light shading, respectively, represent the 67% and 95% confidence intervals. Predictions capture both model and parameter uncertainty, by drawing 1000 sets of estimates both across models (weighted by AIC weight), and within sampled models according to the modelled uncertainty in the parameter estimates. Relationships are plotted for the central 95% of values sampled within each land use"}

par(mfrow=c(2,2))
par(tck=-0.01)
par(mar=c(2.8,2.8,1.2,0.2))
par(mgp=c(1.8,0.2,0))
par(las=1)
par(cex=2)
par(cex.axis=1.3)
par(cex.lab=1.3)
par(cex.text=1.3)

### Natural habitat

# Get the 95% ranges of values for natural habitat for each land-use type
natHabRangeNatural <- quantile(
  modelData$NaturalHabitat[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
natHabRangeHuman <- quantile(
  modelData$NaturalHabitat[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Create data-frame with first row as reference (100% natural habitat), and 
# then plotting ranges for natural and human land use
# Note 100% natural habitat = a value of 1,000
nd <- data.frame(NaturalHabitat=c(1000,
  seq(from = natHabRangeNatural[1],to = natHabRangeNatural[2],
      length.out = 1000),
  seq(from = natHabRangeHuman[1],to = natHabRangeHuman[2],
      length.out = 1000)))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# For reference row, set pesticide to 0, then medians for each land-use type
nd$Pesticide <- c(0,
  rep(median(modelData[modelData$LandUse=="Natural",]$Pesticide),
      1000),
  rep(median(modelData[modelData$LandUse=="Human",]$Pesticide),
      1000))
# For reference row, set fertilizer to 0, then medians for each land-use type
nd$LogFertilizer <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$LogFertilizer),
                      1000))
# For reference row, set landscape age to 0, then
# median values for each land-use type
nd$AgeConv <- c(0,
  rep(median(modelData[modelData$LandUse=="Natural",]$AgeConv),
      1000),
  rep(median(modelData[modelData$LandUse=="Human",]$AgeConv),1000))
# Set baseline TEI to be near range centre, the median of 
# sampled values (i.e. = 0.59)
nd$TEI_BL <- 0.59
# Set delta TEI to 0 (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(models = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0,1000),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,250,500,750,1000),labels = c(0,25,50,75,100))
title(xlab="Landscape natural habitat (%)")

X.Vec <- c(nd$NaturalHabitat[2:1001], max(nd$NaturalHabitat[2:1001]), 
           rev(nd$NaturalHabitat[2:1001]), min(nd$NaturalHabitat[2:1001]))
Y.Vec <- c(preds.lower.95[2:1001], tail(preds.upper.95[2:1001], 1), 
           rev(preds.upper.95[2:1001]), (preds.lower.95[2:1001])[1])
Y.Vec2 <- c(preds.lower.67[2:1001], tail(preds.upper.67[2:1001], 1), 
           rev(preds.upper.67[2:1001]), (preds.lower.67[2:1001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#009F8133",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#009F8155",border=NA)
points(x = nd$NaturalHabitat[2:1001],y = preds.median[2:1001],type="l",lwd=2,col="#009F81")

abline(h=0,lty=2,col="#00000055")

mtext(text = "A",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0,1000),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,250,500,750,1000),labels = c(0,25,50,75,100))
title(xlab="Landscape natural habitat (%)")

X.Vec <- c(nd$NaturalHabitat[1002:2001], max(nd$NaturalHabitat[1002:2001]), 
           rev(nd$NaturalHabitat[1002:2001]), min(nd$NaturalHabitat[1002:2001]))
Y.Vec <- c(preds.lower.95[1002:2001], tail(preds.upper.95[1002:2001], 1), 
           rev(preds.upper.95[1002:2001]), (preds.lower.95[1002:2001])[1])
Y.Vec2 <- c(preds.lower.67[1002:2001], tail(preds.upper.67[1002:2001], 1), 
            rev(preds.upper.67[1002:2001]), (preds.lower.67[1002:2001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#A4012233",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#A4012255",border=NA)
points(x = nd$NaturalHabitat[1002:2001],y = preds.median[1002:2001],
       type="l",lwd=2,col="#A40122")

abline(h=0,lty=2,col="#00000055")

mtext(text = "B",side = 3,line=0,adj = -0.12,cex=2.5)

### Landscape conversion age

# Get the 95% ranges of values for landscape conversion age for each land-use type
ageConvRangeNatural <- quantile(
  modelData$AgeConv[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
ageConvRangeHuman <- quantile(
  modelData$AgeConv[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Create data-frame with first row as reference (the median landscape age 
# across the whole dataset), and  then plotting ranges for natural and 
# human land use
nd <- data.frame(AgeConv=c(median(modelData$AgeConv),
                           seq(from = ageConvRangeNatural[1],
                               to = ageConvRangeNatural[2],
                               length.out = 1000),
                           seq(from = ageConvRangeHuman[1],
                               to = ageConvRangeHuman[2],
                               length.out = 1000)))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# For reference row, set pesticide to 0, then medians for each land-use type
nd$Pesticide <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$Pesticide),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$Pesticide),
                      1000))
# For reference row, set fertilizer to 0, then medians for each land-use type
nd$LogFertilizer <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$LogFertilizer),
                      1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd$NaturalHabitat <- c(1000,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$NaturalHabitat),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$NaturalHabitat),
                         1000))
# Set baseline TEI to be near range centre, the median of 
# sampled values (i.e. = 0.59)
nd$TEI_BL <- 0.59
# Set delta TEI to 0 (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(models = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0,505),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,125,250,375,500))
title(xlab="Duration of landscape modification (yrs)")

X.Vec <- c(nd$AgeConv[2:1001], max(nd$AgeConv[2:1001]), 
           rev(nd$AgeConv[2:1001]), min(nd$AgeConv[2:1001]))
Y.Vec <- c(preds.lower.95[2:1001], tail(preds.upper.95[2:1001], 1), 
           rev(preds.upper.95[2:1001]), (preds.lower.95[2:1001])[1])
Y.Vec2 <- c(preds.lower.67[2:1001], tail(preds.upper.67[2:1001], 1), 
            rev(preds.upper.67[2:1001]), (preds.lower.67[2:1001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#009F8133",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#009F8155",border=NA)
points(x = nd$AgeConv[2:1001],y = preds.median[2:1001],type="l",lwd=2,col="#009F81")

abline(h=0,lty=2,col="#00000055")

mtext(text = "C",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0,505),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,125,250,375,500))
title(xlab="Duration of landscape modification (yrs)")

X.Vec <- c(nd$AgeConv[1002:2001], max(nd$AgeConv[1002:2001]), 
           rev(nd$AgeConv[1002:2001]), min(nd$AgeConv[1002:2001]))
Y.Vec <- c(preds.lower.95[1002:2001], tail(preds.upper.95[1002:2001], 1), 
           rev(preds.upper.95[1002:2001]), (preds.lower.95[1002:2001])[1])
Y.Vec2 <- c(preds.lower.67[1002:2001], tail(preds.upper.67[1002:2001], 1), 
            rev(preds.upper.67[1002:2001]), (preds.lower.67[1002:2001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#A4012233",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#A4012255",border=NA)
points(x = nd$AgeConv[1002:2001],y = preds.median[1002:2001],
       type="l",lwd=2,col="#A40122")

abline(h=0,lty=2,col="#00000055")

mtext(text = "D",side = 3,line=0,adj = -0.12,cex=2.5)
```

Bumblebee occupancy is also shaped by rates of chemical input to the landscape, although less strongly than by landscape habitat characteristics. In natural habitats, the probability of occurrence of bumblebees decreases with increasing pesticide application, and shows a u-shaped relationship with fertiliser application (Figure \@ref(fig:figlui)A,C). In areas of human land use, probability of occurrence increases weakly with both pesticide and fertiliser application, with the latter relationship also being u-shaped (Figure \@ref(fig:figlui)B,D). Modelled effects of pesticide application rate were very similar when using either the low or high estimates of rates from the original dataset [@Maggi2019] (results not shown).

<!-- PLOTTING: Effects of chemical inputs -->
```{r figlui, echo=FALSE, warning=FALSE, fig.width=17.5, fig.height=12,out.width="100%", fig.cap="**Effect of chemical inputs on bumblebee probability of occurrence across land uses**. We considered the density of application of pesticides (A and B) and fertilizers (C and D). Modelled effects are shown for natural (primary and secondary) habitats (A and C) and for human-modified (agricultural and urban) habitats (B and D). All other variables are held at median values for the respective land use, except for baseline temperature niche position that is held at a fixed value across both land-use types of 0.59 (the 10th percentile of values in the original dataset, representing a position near the temperature niche centre), and the change in temperature niche position owing to recent climate change that is held at zero. Values are expressed as the % difference in probability of occurrence compared to natural habitat locally, in a landscape composed entirely of natural habitat, with no history of landscape modification, with no application of agricultural chemicals, and no recent climate change. Lines represent modelled median projections, while dark and light shading, respectively, represent the 67% and 95% confidence intervals. Predictions capture both model and parameter uncertainty, by drawing 1000 sets of estimates both across models (weighted by AIC weight), and within sampled models according to the modelled uncertainty in the parameter estimates. Relationships are plotted for the central 95% of values sampled within each land use"}

par(mfrow=c(2,2))
par(tck=-0.01)
par(mar=c(2.8,2.8,1.2,0.2))
par(mgp=c(1.8,0.2,0))
par(las=1)
par(cex=2)
par(cex.axis=1.3)
par(cex.lab=1.3)
par(cex.text=1.3)

### Pesticide application

# Get the 95% ranges of values for pesticide application for each land-use type
pesticideRangeNatural <- quantile(
  modelData$Pesticide[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
pesticideRangeHuman <- quantile(
  modelData$Pesticide[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Create data-frame with first row as reference (zero pesticide application), 
# and  then plotting ranges for natural and human land use
nd <- data.frame(Pesticide=c(0,
                             seq(from = pesticideRangeNatural[1],
                                   to = pesticideRangeNatural[2],
                                 length.out = 1000),
                             seq(from = pesticideRangeHuman[1],
                                 to = pesticideRangeHuman[2],
                                 length.out = 1000)))
# For reference row, set fertilizer to 0, then medians for each land-use type
nd$LogFertilizer <- c(0,
                      rep(median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
                          1000),
                      rep(median(modelData[modelData$LandUse=="Human",]$LogFertilizer),
                          1000))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# For reference row, set landscape conversion age to median across whole
# dataset, then medians for each land-use type
nd$AgeConv <- c(median(modelData$AgeConv),
                  rep(median(modelData[
                    modelData$LandUse=="Natural",]$AgeConv),1000),
                  rep(median(modelData[
                    modelData$LandUse=="Human",]$AgeConv),1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd$NaturalHabitat <- c(1000,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$NaturalHabitat),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$NaturalHabitat),
                         1000))
# Set baseline TEI to be near range centre, the median of 
# sampled values (i.e. = 0.59)
nd$TEI_BL <- 0.59
# Set delta TEI to 0 (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(models = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0,40),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,10,20,30,40))
title(xlab="Pesticide application (kg/ha)")

X.Vec <- c(nd$Pesticide[2:1001], max(nd$Pesticide[2:1001]), 
           rev(nd$Pesticide[2:1001]), min(nd$Pesticide[2:1001]))
Y.Vec <- c(preds.lower.95[2:1001], tail(preds.upper.95[2:1001], 1), 
           rev(preds.upper.95[2:1001]), (preds.lower.95[2:1001])[1])
Y.Vec2 <- c(preds.lower.67[2:1001], tail(preds.upper.67[2:1001], 1), 
            rev(preds.upper.67[2:1001]), (preds.lower.67[2:1001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#009F8133",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#009F8155",border=NA)
points(x = nd$Pesticide[2:1001],y = preds.median[2:1001],type="l",lwd=2,col="#009F81")

abline(h=0,lty=2,col="#00000055")

mtext(text = "A",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0,40),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,10,20,30,40))
title(xlab="Pesticide application (kg/ha)")

X.Vec <- c(nd$Pesticide[1002:2001], max(nd$Pesticide[1002:2001]), 
           rev(nd$Pesticide[1002:2001]), min(nd$Pesticide[1002:2001]))
Y.Vec <- c(preds.lower.95[1002:2001], tail(preds.upper.95[1002:2001], 1), 
           rev(preds.upper.95[1002:2001]), (preds.lower.95[1002:2001])[1])
Y.Vec2 <- c(preds.lower.67[1002:2001], tail(preds.upper.67[1002:2001], 1), 
            rev(preds.upper.67[1002:2001]), (preds.lower.67[1002:2001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#A4012233",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#A4012255",border=NA)
points(x = nd$Pesticide[1002:2001],y = preds.median[1002:2001],
       type="l",lwd=2,col="#A40122")

abline(h=0,lty=2,col="#00000055")

mtext(text = "B",side = 3,line=0,adj = -0.12,cex=2.5)

### Fertilizer application

# Get the 95% ranges of values for pesticide application for each land-use type
fertilizerRangeNatural <- quantile(
  modelData$LogFertilizer[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
fertilizerRangeHuman <- quantile(
  modelData$LogFertilizer[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Create data-frame with first row as reference (zero pesticide application), 
# and  then plotting ranges for natural and human land use
nd <- data.frame(LogFertilizer=c(0,
                             seq(from = fertilizerRangeNatural[1],
                                 to = fertilizerRangeNatural[2],
                                 length.out = 1000),
                             seq(from = fertilizerRangeHuman[1],
                                 to = fertilizerRangeHuman[2],
                                 length.out = 1000)))
# For reference row, set pesticide to 0, then medians for each land-use type
nd$Pesticide <- c(0,
                      rep(median(modelData[modelData$LandUse=="Natural",]$Pesticide),
                          1000),
                      rep(median(modelData[modelData$LandUse=="Human",]$Pesticide),
                          1000))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# For reference row, set landscape conversion age to median across whole
# dataset, then medians for each land-use type
nd$AgeConv <- c(median(modelData$AgeConv),
                rep(median(modelData[
                  modelData$LandUse=="Natural",]$AgeConv),1000),
                rep(median(modelData[
                  modelData$LandUse=="Human",]$AgeConv),1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd$NaturalHabitat <- c(1000,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$NaturalHabitat),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$NaturalHabitat),
                         1000))
# Set baseline TEI to be near range centre, the median of 
# sampled values (i.e. = 0.59)
nd$TEI_BL <- 0.59
# Set delta TEI to 0 (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(models = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0,13.5),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,
     at = log(c(0,20,400,8000,700000)+1),
     labels=c(0,20,400,8000,700000))
title(xlab="Fertilizer application (kg/ha)")

X.Vec <- c(nd$LogFertilizer[2:1001], max(nd$LogFertilizer[2:1001]), 
           rev(nd$LogFertilizer[2:1001]), min(nd$LogFertilizer[2:1001]))
Y.Vec <- c(preds.lower.95[2:1001], tail(preds.upper.95[2:1001], 1), 
           rev(preds.upper.95[2:1001]), (preds.lower.95[2:1001])[1])
Y.Vec2 <- c(preds.lower.67[2:1001], tail(preds.upper.67[2:1001], 1), 
            rev(preds.upper.67[2:1001]), (preds.lower.67[2:1001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#009F8133",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#009F8155",border=NA)
points(x = nd$LogFertilizer[2:1001],y = preds.median[2:1001],type="l",lwd=2,col="#009F81")

abline(h=0,lty=2,col="#00000055")

mtext(text = "C",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0,13.5),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,
     at = log(c(0,20,400,8000,700000)+1),
     labels=c(0,20,400,8000,700000))
title(xlab="Fertilizer application (kg/ha)")

X.Vec <- c(nd$LogFertilizer[1002:2001], max(nd$LogFertilizer[1002:2001]), 
           rev(nd$LogFertilizer[1002:2001]), min(nd$LogFertilizer[1002:2001]))
Y.Vec <- c(preds.lower.95[1002:2001], tail(preds.upper.95[1002:2001], 1), 
           rev(preds.upper.95[1002:2001]), (preds.lower.95[1002:2001])[1])
Y.Vec2 <- c(preds.lower.67[1002:2001], tail(preds.upper.67[1002:2001], 1), 
            rev(preds.upper.67[1002:2001]), (preds.lower.67[1002:2001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#A4012233",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#A4012255",border=NA)
points(x = nd$LogFertilizer[1002:2001],y = preds.median[1002:2001],
       type="l",lwd=2,col="#A40122")

abline(h=0,lty=2,col="#00000055")

mtext(text = "D",side = 3,line=0,adj = -0.12,cex=2.5)
```

Finally, bumblebee probability of occurrence is strongly influenced by the climatic niche properties of species, and how these properties have been modified by recent climate change. Ignoring the effects of climate change initially, populations near the centre of the species' temperature  niche showed the greatest declines in probability of occurrence between natural and human-modified habitats, whereas for populations nearer the upper limit of the temperature niche, there was little difference in occupancy (Figure \@ref(fig:figclim)A,B). An increase in realized temperature niche position caused by climate warming had a negative effect on probability of occurrence in natural habitats, especially for populations near the species' temperature niche centre (Figure \@ref(fig:figclim)C). In contrast, the effect of climate warming in human land uses was less clear, and there was a weak positive effect if anything (Figure \@ref(fig:figclim)D).

<!-- PLOTTING: Effects of climatic niche properties and climate change -->
```{r figclim, echo=FALSE, warning=FALSE, fig.width=17.5, fig.height=12,out.width="100%", fig.cap="**Effect of climatic niche properties and climate change on bumblebee probability of occurrence across land uses**. We considered the effects of realized temperature niche position in a baseline period (1901 - 1975) (A and B) and change in realized temperature niche position between the baseline and a recent period (2000 - 2014) (C and D). A temperature niche position value of 0 represents a population at the cold edge of the species' realized temperature niche, while a value of 1 represents a population at the warm edge of the species' realized temperature niche. Modelled effects are shown for natural (primary and secondary) habitats (A and C) and for human-modified (agricultural and urban) habitats (B and D). For change in temperature niche position, we further sub-divide modelled responses according to baseline temperature niche position, plotting modelled relationships for populations near the species' temperature niche centre (a value of 0.59, representing the 10th percentile of values sampled in the original dataset; solid lines) and species nearer the niche edge (a value of 0.73, representing the 90th percentile of values sampled in the original dataset; dashed lines). All other variables are held at median values for the respective land use. Values are expressed as the % difference in probability of occurrence compared to natural habitat locally, in a landscape composed entirely of natural habitat, with no history of landscape modification, with no application of agricultural chemicals, and no recent climate change. Lines represent modelled median projections, while dark and light shading, respectively, represent the 67% and 95% confidence intervals. Predictions capture both model and parameter uncertainty, by drawing 1000 sets of estimates both across models (weighted by AIC weight), and within sampled models according to the modelled uncertainty in the parameter estimates. Relationships are plotted for the central 95% of values sampled within each land use"}

par(mfrow=c(2,2))
par(tck=-0.01)
par(mar=c(2.8,2.8,1.2,0.2))
par(mgp=c(1.8,0.2,0))
par(las=1)
par(cex=2)
par(cex.axis=1.3)
par(cex.lab=1.3)
par(cex.text=1.3)

### Baseline niche position

# Get the 95% ranges of values for pesticide application for each land-use type
tei_blRangeNatural <- quantile(
  modelData$TEI_BL[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
tei_blRangeHuman <- quantile(
  modelData$TEI_BL[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Create data-frame with first row as reference (near niche centre, i.e.
# 10th percentile of sampled values = 0.59), 
# and  then plotting ranges for natural and human land use
nd <- data.frame(TEI_BL=c(0.59,
                             seq(from = tei_blRangeNatural[1],
                                 to = tei_blRangeNatural[2],
                                 length.out = 1000),
                             seq(from = tei_blRangeHuman[1],
                                 to = tei_blRangeHuman[2],
                                 length.out = 1000)))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd$LandUse <- relevel(x = nd$LandUse,ref = "Natural")
# For reference row, set landscape conversion age to median across whole
# dataset, then medians for each land-use type
nd$AgeConv <- c(median(modelData$AgeConv),
                rep(median(modelData[
                  modelData$LandUse=="Natural",]$AgeConv),1000),
                rep(median(modelData[
                  modelData$LandUse=="Human",]$AgeConv),1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd$NaturalHabitat <- c(1000,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$NaturalHabitat),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$NaturalHabitat),
                         1000))
# For reference row, set pesticide to 0, then medians for each land-use type
nd$Pesticide <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$Pesticide),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$Pesticide),
                      1000))
# For reference row, set fertilizer to 0, then medians for each land-use type
nd$LogFertilizer <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$LogFertilizer),
                      1000))
# Set delta TEI to 0 (i.e. no climate change)
nd$TEI_delta <- 0
# Add dummy variable representing the response variable
nd$occur <- 0

# Make predictions from model
preds <- PredictGLMERMultiModel(models = finalModels,data = nd,nIters = 1000)

# Back-transform to occurrence probabilities
preds <- 1/(1+exp(-preds))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds <- sweep(x = preds,MARGIN = 2,STATS = preds[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median <- ((apply(X = preds,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95 <- ((apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0.5,0.8),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0.5,0.6,0.7,0.8))
title(xlab="Baseline temperature niche position")

X.Vec <- c(nd$TEI_BL[2:1001], max(nd$TEI_BL[2:1001]), 
           rev(nd$TEI_BL[2:1001]), min(nd$TEI_BL[2:1001]))
Y.Vec <- c(preds.lower.95[2:1001], tail(preds.upper.95[2:1001], 1), 
           rev(preds.upper.95[2:1001]), (preds.lower.95[2:1001])[1])
Y.Vec2 <- c(preds.lower.67[2:1001], tail(preds.upper.67[2:1001], 1), 
            rev(preds.upper.67[2:1001]), (preds.lower.67[2:1001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#009F8133",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#009F8155",border=NA)
points(x = nd$TEI_BL[2:1001],y = preds.median[2:1001],type="l",lwd=2,col="#009F81")

abline(h=0,lty=2,col="#00000055")

mtext(text = "A",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0.5,0.8),
     ylim=c(min(preds.lower.95),max(preds.upper.95)),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0.5,0.6,0.7,0.8))
title(xlab="Baseline temperature niche position")

X.Vec <- c(nd$TEI_BL[1002:2001], max(nd$TEI_BL[1002:2001]), 
           rev(nd$TEI_BL[1002:2001]), min(nd$TEI_BL[1002:2001]))
Y.Vec <- c(preds.lower.95[1002:2001], tail(preds.upper.95[1002:2001], 1), 
           rev(preds.upper.95[1002:2001]), (preds.lower.95[1002:2001])[1])
Y.Vec2 <- c(preds.lower.67[1002:2001], tail(preds.upper.67[1002:2001], 1), 
            rev(preds.upper.67[1002:2001]), (preds.lower.67[1002:2001])[1])

polygon(x = X.Vec,y = Y.Vec,col="#A4012233",border=NA)
polygon(x = X.Vec,y = Y.Vec2,col="#A4012255",border=NA)
points(x = nd$TEI_BL[1002:2001],y = preds.median[1002:2001],
       type="l",lwd=2,col="#A40122")

abline(h=0,lty=2,col="#00000055")

mtext(text = "B",side = 3,line=0,adj = -0.12,cex=2.5)

### Niche position change

# Get the 95% ranges of values for niche position change for each land-use type
tei_deltaRangeNatural <- quantile(
  modelData$TEI_delta[modelData$LandUse=="Natural"],
  probs = c(0.025,0.975))
tei_deltaRangeHuman <- quantile(
  modelData$TEI_delta[modelData$LandUse=="Human"],
  probs = c(0.025,0.975))

# Set the plotting ranges to span from 0 (no climate change) to the upper 95%
# range of values
tei_deltaRangeNatural <- c(0,tei_deltaRangeNatural[2])
tei_deltaRangeHuman <- c(0,tei_deltaRangeHuman[2])

# Create data-frame for niche-centre predictions, with first row as 
# reference (no climate change), and  then plotting ranges for natural 
# and human land use
nd.centre <- data.frame(TEI_delta=c(0,
                          seq(from = tei_deltaRangeNatural[1],
                              to = tei_deltaRangeNatural[2],
                              length.out = 1000),
                          seq(from = tei_deltaRangeHuman[1],
                              to = tei_deltaRangeHuman[2],
                              length.out = 1000)))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd.centre$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd.centre$LandUse <- relevel(x = nd.centre$LandUse,ref = "Natural")
# For reference row, set landscape conversion age to median across whole
# dataset, then medians for each land-use type
nd.centre$AgeConv <- c(median(modelData$AgeConv),
                rep(median(modelData[
                  modelData$LandUse=="Natural",]$AgeConv),1000),
                rep(median(modelData[
                  modelData$LandUse=="Human",]$AgeConv),1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd.centre$NaturalHabitat <- c(1000,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$NaturalHabitat),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$NaturalHabitat),
                         1000))
# For reference row, set pesticide to 0, then medians for each land-use type
nd.centre$Pesticide <- c(0,
                  rep(median(modelData[modelData$LandUse=="Natural",]$Pesticide),
                      1000),
                  rep(median(modelData[modelData$LandUse=="Human",]$Pesticide),
                      1000))
# For reference row, set pesticide to 0, then medians for each land-use type
nd.centre$LogFertilizer <- c(0,
                         rep(median(modelData[modelData$LandUse=="Natural",]$LogFertilizer),
                             1000),
                         rep(median(modelData[modelData$LandUse=="Human",]$LogFertilizer),
                             1000))
# Set baseline niche position to near niche centre (position = 0.59)
# Represents 10th percentile of sampled values
nd.centre$TEI_BL <- 0.59
# Add dummy variable representing the response variable
nd.centre$occur <- 0

# Create data-frame for niche-edge predictions, with first row as 
# reference (no climate change), and  then plotting ranges for natural 
# and human land use
nd.edge <- data.frame(TEI_delta=c(0,
                                    seq(from = tei_deltaRangeNatural[1],
                                        to = tei_deltaRangeNatural[2],
                                        length.out = 1000),
                                    seq(from = tei_deltaRangeHuman[1],
                                        to = tei_deltaRangeHuman[2],
                                        length.out = 1000)))
# Reference row takes natural habitat, then 1000 values each of natural
# and human land use
nd.edge$LandUse <- factor(c(rep("Natural",1001),rep("Human",1000)))
nd.edge$LandUse <- relevel(x = nd.edge$LandUse,ref = "Natural")
# For reference row, set landscape conversion age to median across whole
# dataset, then medians for each land-use type
nd.edge$AgeConv <- c(median(modelData$AgeConv),
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$AgeConv),1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$AgeConv),1000))
# For reference row, set natural habitat to 100%, then
# median values for each land-use type
# Note 100% natural habitat = a value of 1,000
nd.edge$NaturalHabitat <- c(1000,
                              rep(median(modelData[
                                modelData$LandUse=="Natural",]$NaturalHabitat),
                                1000),
                              rep(median(modelData[
                                modelData$LandUse=="Human",]$NaturalHabitat),
                                1000))
# For reference row, set pesticide to 0, then medians for each land-use type
nd.edge$Pesticide <- c(0,
                         rep(median(modelData[
                           modelData$LandUse=="Natural",]$Pesticide),
                             1000),
                         rep(median(modelData[
                           modelData$LandUse=="Human",]$Pesticide),
                             1000))
# For reference row, set pesticide to 0, then medians for each land-use type
nd.edge$LogFertilizer <- c(0,
                       rep(median(modelData[
                         modelData$LandUse=="Natural",]$LogFertilizer),
                         1000),
                       rep(median(modelData[
                         modelData$LandUse=="Human",]$LogFertilizer),
                         1000))
# Set baseline niche position to near niche edge (position = 0.73)
# Represents 90th percentile of sampled values
nd.edge$TEI_BL <- 0.73
# Add dummy variable representing the response variable
nd.edge$occur <- 0

# Make predictions from model, for both niche-centre and niche-edge
preds.centre <- PredictGLMERMultiModel(
  models = finalModels,data = nd.centre,nIters = 1000)
preds.edge <- PredictGLMERMultiModel(
  models = finalModels,data = nd.edge,nIters = 1000)

# Back-transform to occurrence probabilities
preds.centre <- 1/(1+exp(-preds.centre))
preds.edge <- 1/(1+exp(-preds.edge))

# Rescale predictions to reference level (i.e. all probabilities = 1 in 
# natural habitat)
preds.centre <- sweep(x = preds.centre,MARGIN = 2,STATS = preds.centre[1,],FUN = '/')
preds.edge <- sweep(x = preds.edge,MARGIN = 2,STATS = preds.edge[1,],FUN = '/')

# Calculate summary statistics across predictions
preds.median.centre <- ((apply(X = preds.centre,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67.centre <- ((apply(X = preds.centre,MARGIN = 1,FUN = quantile,probs=(1/6),
                          na.rm=TRUE))*100)-100
preds.upper.67.centre <- ((apply(X = preds.centre,MARGIN = 1,FUN = quantile,probs=(5/6),
                          na.rm=TRUE))*100)-100
preds.lower.95.centre <- ((apply(X = preds.centre,MARGIN = 1,FUN = quantile,probs=0.025,
                          na.rm=TRUE))*100)-100
preds.upper.95.centre <- ((apply(X = preds.centre,MARGIN = 1,FUN = quantile,probs=0.975,
                          na.rm=TRUE))*100)-100

preds.median.edge <- ((apply(X = preds.edge,MARGIN = 1,FUN = median,na.rm=TRUE))*100)-100
preds.lower.67.edge <- ((apply(X = preds.edge,MARGIN = 1,FUN = quantile,probs=(1/6),
                                 na.rm=TRUE))*100)-100
preds.upper.67.edge <- ((apply(X = preds.edge,MARGIN = 1,FUN = quantile,probs=(5/6),
                                 na.rm=TRUE))*100)-100
preds.lower.95.edge <- ((apply(X = preds.edge,MARGIN = 1,FUN = quantile,probs=0.025,
                                 na.rm=TRUE))*100)-100
preds.upper.95.edge <- ((apply(X = preds.edge,MARGIN = 1,FUN = quantile,probs=0.975,
                                 na.rm=TRUE))*100)-100

plot(-9e99,-9e99,xlim=c(0,0.033),
     ylim=c(-100,0),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,0.01,0.02,0.03))
title(xlab="Niche position change")

X.Vec.centre <- c(nd.centre$TEI_delta[2:1001], max(nd.centre$TEI_delta[2:1001]), 
           rev(nd.centre$TEI_delta[2:1001]), min(nd.centre$TEI_delta[2:1001]))
Y.Vec.centre <- c(preds.lower.95.centre[2:1001], tail(preds.upper.95.centre[2:1001], 1), 
           rev(preds.upper.95.centre[2:1001]), (preds.lower.95.centre[2:1001])[1])
Y.Vec2.centre <- c(preds.lower.67.centre[2:1001], tail(preds.upper.67.centre[2:1001], 1), 
            rev(preds.upper.67.centre[2:1001]), (preds.lower.67.centre[2:1001])[1])

X.Vec.edge <- c(nd.edge$TEI_delta[2:1001], max(nd.edge$TEI_delta[2:1001]), 
                  rev(nd.edge$TEI_delta[2:1001]), min(nd.edge$TEI_delta[2:1001]))
Y.Vec.edge <- c(preds.lower.95.edge[2:1001], tail(preds.upper.95.edge[2:1001], 1), 
                  rev(preds.upper.95.edge[2:1001]), (preds.lower.95.edge[2:1001])[1])
Y.Vec2.edge <- c(preds.lower.67.edge[2:1001], tail(preds.upper.67.edge[2:1001], 1), 
                   rev(preds.upper.67.edge[2:1001]), (preds.lower.67.edge[2:1001])[1])

polygon(x = X.Vec.centre,y = Y.Vec2.centre,col="#009F8188",border=NA)
points(x = nd.centre$TEI_delta[2:1001],y = preds.median.centre[2:1001],
       type="l",lwd=2,col="#009F81")

polygon(x = X.Vec.edge,y = Y.Vec2.edge,col="#009F8188",border=NA)
points(x = nd.edge$TEI_delta[2:1001],y = preds.median.edge[2:1001],
       type="l",lwd=2,col="#009F81",lty=2)


abline(h=0,lty=2,col="#00000055")

mtext(text = "C",side = 3,line=0,adj = -0.12,cex=2.5)

plot(-9e99,-9e99,xlim=c(0,0.033),
     ylim=c(-100,0),xaxt="n",
     xlab=NA,ylab="P.occur difference (%)",bty="l")
axis(side = 1,at = c(0,0.01,0.02,0.03))
title(xlab="Niche position change")

X.Vec.centre <- c(nd.centre$TEI_delta[1002:2001], max(nd.centre$TEI_delta[1002:2001]), 
                  rev(nd.centre$TEI_delta[1002:2001]), min(nd.centre$TEI_delta[1002:2001]))
Y.Vec.centre <- c(preds.lower.95.centre[1002:2001], tail(preds.upper.95.centre[1002:2001], 1), 
                  rev(preds.upper.95.centre[1002:2001]), (preds.lower.95.centre[1002:2001])[1])
Y.Vec2.centre <- c(preds.lower.67.centre[1002:2001], tail(preds.upper.67.centre[1002:2001], 1), 
                   rev(preds.upper.67.centre[1002:2001]), (preds.lower.67.centre[1002:2001])[1])

X.Vec.edge <- c(nd.edge$TEI_delta[1002:2001], max(nd.edge$TEI_delta[1002:2001]), 
                rev(nd.edge$TEI_delta[1002:2001]), min(nd.edge$TEI_delta[1002:2001]))
Y.Vec.edge <- c(preds.lower.95.edge[1002:2001], tail(preds.upper.95.edge[1002:2001], 1), 
                rev(preds.upper.95.edge[1002:2001]), (preds.lower.95.edge[1002:2001])[1])
Y.Vec2.edge <- c(preds.lower.67.edge[1002:2001], tail(preds.upper.67.edge[1002:2001], 1), 
                 rev(preds.upper.67.edge[1002:2001]), (preds.lower.67.edge[1002:2001])[1])

polygon(x = X.Vec.centre,y = Y.Vec2.centre,col="#A4012288",border=NA)
points(x = nd.centre$TEI_delta[1002:2001],y = preds.median.centre[1002:2001],
       type="l",lwd=2,col="#A40122")

polygon(x = X.Vec.edge,y = Y.Vec2.edge,col="#A4012288",border=NA)
points(x = nd.edge$TEI_delta[1002:2001],y = preds.median.edge[1002:2001],
       type="l",lwd=2,col="#A40122",lty=2)

abline(h=0,lty=2,col="#00000055")

mtext(text = "D",side = 3,line=0,adj = -0.12,cex=2.5)

```

The models deviated slightly from the assumptions of standard parametric statistical tests (Figure S2). Nevertheless, very similar model-predicted values were obtained when refitting the final best-fitting model using MCMC, which is a fundamentally different approach to fitting estimates of model parameters (Figure S3). Spatial autocorrelation was detected in the residuals associated with a slightly higher fraction (11.8%) of underlying studies than would be expected by chance (Figure S4).

```{r preds_sites, echo=FALSE,results=FALSE}

#### Predictions for sampled locations ####

# Create baseline data-frame with all natural land use, 100% surrounding natural
# habitat (note that 100% is stored as 1,000), no pesticide and no climate change
nd.bl <- modelData
nd.bl$LandUse <- factor("Natural",levels=c("Natural","Human"))
nd.bl$NaturalHabitat <- 1000
nd.bl$Pesticide <- 0
nd.bl$LogFertilizer <- 0
nd.bl$AgeConv <- 0
nd.bl$TEI_delta <- 0

# Extract observed data-frame
nd.obs <- modelData

# Get AIC values of final set of models
aics <- unlist(lapply(finalModels,AIC))

# Get differences in AIC values from best-fitting model
aic.diffs <- aics - min(aics)

# Calculate AIC weights
aic.weights <- exp(-0.5 * aic.diffs)/sum(exp(-0.5 * aic.diffs))

preds <- suppressWarnings(sapply(X = 1:1000, FUN = function(i) {
  
  ## Select model at random, weighted by AIC weight
  model <- finalModels[[sample(x = 1:length(finalModels),size = 1,
                  replace = FALSE,prob = aic.weights)]]
  
  ## Draw model coefficients
  fe.draw <- mvrnorm(n = 1, mu = fixef(model), 
                     Sigma = vcov(model))
  
  ## Make predictions using the baseline data
  # Create the model matrix
  mm.bl <- model.matrix(terms(model), nd.bl)
  # Remove any redundant columns from the model matrix
  if (ncol(mm.bl) > length(lme4::fixef(model))) {
    mm.bl <- mm.bl[, -which(!(
      names(mm.bl[1, ]) %in% names(
        lme4::fixef(model))))]
  }
  # Calculate predicted 
  y.bl <- mm.bl %*% fe.draw
  y.bl <- 1/(1+exp(-(y.bl)))
  
  mm.obs <- model.matrix(terms(model), nd.obs)
  if (ncol(mm.obs) > length(lme4::fixef(model))) {
    mm.obs <- mm.obs[, -which(!(
      names(mm.obs[1, ]) %in% names(
        lme4::fixef(model))))]
  }
  
  y.obs <- mm.obs %*% fe.draw
  y.obs <- 1/(1+exp(-(y.obs)))
  
  y <- ((y.obs/y.bl)*100)-100
  
  return(y)
}))

y.median <- apply(X = preds,MARGIN = 1,FUN = median)
y.lower.95 <- apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.025)
y.upper.95 <- apply(X = preds,MARGIN = 1,FUN = quantile,probs=0.975)
y.lower.67 <- apply(X = preds,MARGIN = 1,FUN = quantile,probs=(1/6))
y.upper.67 <- apply(X = preds,MARGIN = 1,FUN = quantile,probs=(5/6))

lu.means.median <- tapply(X = y.median,INDEX = nd.obs$LandUse,FUN = median)
lu.means.lower.95 <- tapply(X = y.lower.95,INDEX = nd.obs$LandUse,FUN = median)
lu.means.upper.95 <- tapply(X = y.upper.95,INDEX = nd.obs$LandUse,FUN = median)
lu.means.lower.67 <- tapply(X = y.lower.67,INDEX = nd.obs$LandUse,FUN = median)
lu.means.upper.67 <- tapply(X = y.upper.67,INDEX = nd.obs$LandUse,FUN = median)


```

Using the models to infer bumblebee probability of occupancy at the sampled sites, compared to the probability under hypothetical baseline conditions (natural habitat locally and across the whole landscape, no history of human land use, no application of agricultural chemicals, and no climate change), we estimate that bumblebee occupancy has been reduced by `r -round(lu.means.median['Natural'],0)`% (95% CI: `r -round(lu.means.upper.95['Natural'],0)`% &ndash; `r -round(lu.means.lower.95['Natural'],0)`%) across sampled natural habitats, and by `r -round(lu.means.median['Human'],0)`% (95% CI: `r -round(lu.means.upper.95['Human'],0)`% &ndash; `r -round(lu.means.lower.95['Human'],0)`%) across sampled human land uses (Figure \@ref(fig:figpredssites)).

```{r figpredssites, echo=FALSE, warning=FALSE, fig.width=8.5, fig.height=6,out.width="50%", fig.cap="**Model-inferred differences in average bumblebee probability of occupancy at sampled sites in natural (primary and secondary) habitats and human-modified (agricultural and urban) habitats, compared to hypothetical baseline conditions (natural land use across the whole landscape, no human land-use history, no agricultural chemical application, and no climate change)**. Predictions were generated for every species recorded at each sampled site across both natural and human-modified habitats, based on the values of the explanatory variables as estimated for the sampled sites. We then average the predictions across all species and all sampled sites to generate the average predictions for natural and human-modified habitats. Points show the median prediction, while thick and thin error bars, respectively, represent the 67% and 95% confidence intervals. Predictions capture both model and parameter uncertainty, by drawing 1000 sets of estimates both across models (weighted by AIC weight), and within sampled models according to the modelled uncertainty in the parameter estimates"}

par(tck=-0.01)
par(mar=c(2.8,2.8,1.2,0.2))
par(mgp=c(1.8,0.2,0))
par(las=1)
par(cex=2)
par(cex.axis=1.3)
par(cex.lab=1.3)
par(cex.text=1.3)

# Plot error bars for 67% and 95% confidence intervals
errbar(x = 1:2,y = lu.means.median,yplus = lu.means.upper.95,
       yminus = lu.means.lower.95,
       pch=16,cap = 0,xaxt="n",
       xlim=c(0.6,2.4),ylim=c(min(lu.means.lower.95),5),
       lwd=1.5,cex = 1.6,bty="l",
       errbar.col = c("#009F81","#A40122"),col = c("#009F81","#A40122"),
       xlab=NA,ylab="P.occur difference (%)")
errbar(x = 1:2,y = lu.means.median,yplus = lu.means.upper.67,
       yminus = lu.means.lower.67,
       pch=16,cap = 0,xaxt="n",xlim=c(0.6,2.4),lwd=3.5,cex = 1.6,add = TRUE,
       errbar.col = c("#009F81","#A40122"),col = c("#009F81","#A40122"),
       xlab=NA,ylab="P.occur difference (%)")

axis(side = 1,at = c(1,2),labels = c("Natural","Human-modified"))
title(xlab="Land use")
abline(h=0,lty=2,col="#00000055")

```

# Discussion

Our results reveal important interactive effects of climate change and land use on bumblebee biodiversity. There is a growing recognition that synergistic interactions among pressures, especially land-use-climate interactions, may be exacerbating ongoing biodiversity changes [@Oliver2014; @Williams2020], but relatively few studies have investigated such interactions in the context of insect biodiversity change [@Oliver2017; @Hamblin2017; @Waldock2020; @Outhwaite2022]. While a correlative empirical analysis such as ours cannot confidently elucidate mechanisms, it is likely that two mechanisms play a key role: microclimatic changes associated with land-use change; and habitat fragmentation impeding responses to climate change [@Oliver2014]. We estimate that bumblebee occupancy has been reduced substantially across both natural habitats and human-modified areas. As climate changes intensify, and further modification of land use occurs, changes in bumblebee biodiversity are likely to accelerate.

We find that bumblebee occupancy is reduced most in areas of human land use, especially in landscapes with a lower cover of natural habitats that have been modified by humans for a long period of time. Our findings are consistent with previous, local or regional-scale studies, which generally found negative effects of human land use, and positive effects of landscape semi-natural habitat on bumblebee diversity [@Samuelson2018; @Proesmans2019; @Janousek2023]. By analysing a collation of data spanning two continents, we show the generality of these effects, and also highlight the importance of landscape land-use history in shaping responses. Importantly, our findings show that responses to land use interact strongly with climate change and with the position of populations within species' climatic niches.

Interestingly, bumblebee occupancy is reduced most by human land use in the centre of species' temperature niches. A previous study of vertebrate species showed that populations are more likely to be lost in human-disturbed land uses near the edge of species' thermal niches, specifically where populations are near their upper realized temperature limit [@Williams2021]. At the same time, a study of insects showed that species affiliated with cooler and wetter conditions were more likely to be absent in human land uses than those affiliated with warmer and drier conditions [@Waldock2020]. These previous results are expected, given that human-disturbed land uses have hotter and drier local climates than natural habitats [@Frishkoff2015; @Senior2017]. Our finding of disproportionate losses in human land uses in the centre of species' temperature niches is not consistent with local climatic changes being the principal mechanism.

Climate warming, which moves populations closer to species' upper thermal limits, reduced occupancy in natural habitats, but not consistently in human land uses. This contrasts somewhat with the results of a study on birds in North America, where declines in response to habitat loss were strongest where summer temperatures had warmed the most  [@Northrup2019]. The strong negative response of bumblebees to human land use in the temperature niche centre, and the negative effect of climate change in natural habitats, may be associated with factors such as resource limitation [@Requier2020; @McCombs2022], rather than local climatic changes. At the same time, the relative resilience of bumblebee populations to land use at the upper edge of species' thermal niche possibly points towards some local adaptation to climatic conditions, as suggested by previous studies [@Jackson2020]. On the other hand, other studies have suggested limited local adaptation to climate in bumblebees [@Martinet2021], which is consistent with the disproportionate declines of bumblebee occupancy seen at species' upper thermal limits in response to recent climate change [@Soroye2020]. Thus, it would appear that the way interactive effects of climate change and land-use change play out across the niches of bumblebee species is more complicated than appears to be the case for other groups of species.

Surprisingly, land-use intensification, measured here in terms of pesticide and fertilizer application rates, had relatively little effect on bumblebee biodiversity. However, we caution that the available global data on application of agricultural chemicals are resolved only at a coarse spatial resolution of 5 arc-minutes (approximately 10 km at the Equator) [@Mueller2012; @Maggi2019]. Similar studies to ours have also found weak effects of fertilizer application rate using the same dataset [@Outhwaite2022], while a study of UK bees found detectable, but weak, effects of pesticide (specifically neonicotinoid) exposure on population trends [@Woodcock2016]. The results of these analyses of field data, using coarse-scale estimates of pesticide application rates, contrast strongly with results based on experimental exposure of bees to neonicotinoid pesticides both in the lab and the field [@Whitehorn2012; @Stuligross2021]. There is thus an urgent need for more detailed and finely resolved continental or global spatial data on the application of specific pesticides, as well as biodiversity data that can be associated more precisely with these application data.

Our results highlight the growing impacts on biodiversity from interactions among pressures, which will likely intensify rapidly in the coming decades. Based on the current credible policies and actions of the world's countries, the global average climate is expected to warm by around 2.7$^\circ$C by 2100 [@CAT2022]. This will likely lead to decreases, on average, in bumblebee diversity [@Prestele2021; @Marshall2018; @Soroye2020], with our results highlighting particularly important declines in natural habitats. While, in general, Europe and North America are expected to see a reduction in cropland area in future, with relatively little change in agricultural intensity compared to other world regions [@Zabel2019], ongoing changes in agricultural practices are highly likely. We highlight the complex interplay of land-use and climatic factors in shaping bumblebee biodiversity, which need to be considered when predicting changes in biodiversity. Our findings also point to some potential interventions that could mitigate losses of bumblebee biodiversity. In particular, efforts to return areas of agriculture to a natural state, and to restore patches of natural habitat within farmed landscapes, are likely strongly to benefit bumblebees, and probably also other insect groups [@Outhwaite2022]. However, any efforts to improve bumblebee biodiversity through changes in land use are unlikely to be successful unless the rate of climate change is also reduced.

Using our models to infer historical changes in bumblebee occupancy suggests that modification of landscapes, combined with recent climate change, has reduced bumblebee biodiversity within natural habitats almost as much as in human-modified areas, creating a 'shifted baseline' [@Pauly1995] in the present day. While agricultural areas experience the direct impacts of habitat loss, many natural habitats are exposed to degradation of their surrounding landscapes, while both natural and human-modified areas are exposed to the effects of climate change. Land-use impacts are often quantified using spatial analyses, comparing sampled biodiversity between natural and modified areas [@Newbold2015]. The fact that natural habitats are composed of depauperate communities, heavily impacted by changes in their landscapes, means that such estimates are likely to underestimate land-use impacts substantially [@Newbold2019].

Understanding changes in biodiversity through time using a spatial database of species records is inevitably subject to certain limitations. Most importantly, such an analysis does not permit a consideration of the dynamics of biodiversity change [@DePalma2018]. However, time-series data for insects are lacking in most regions, making a spatial analysis the only way to infer insect biodiversity changes at continental to global scales. Another limitation, mentioned earlier, is the reliance of large-scale studies on coarsely resolved estimates of the pressures on biodiversity. While the availability of fine-scale land-use/land-cover data has improved rapidly in recent years [@Jung2020], we still lack fine-scale estimates of the application of agricultural chemicals, a particularly important pressure on flying insect biodiversity [@Wagner2021]. To estimate the position of populations within species' temperature niches, we use information on species' realized distributions with respect to temperature. Such realized temperature limits may not correspond with the fundamental physiological limits of species, but estimates of the latter [@Bennett2018] are available for too few species to be useful in large-scale analyses such as ours. A previous study showed that realized thermal limits are clearly associated with occupancy change in response to recent climate change [@Soroye2020], suggesting that our approach is valid. Finally, all correlative analyses are limited in their ability to deduce causal mechanisms with certainty. The complexity of the interactive effects we document highlights a need for more experimental studies or detailed field-level assessments to investigate the mechanistic basis for the patterns we report.

In conclusion, we show that interactions between climate change and land use drive rapid and substantial changes in bumblebee biodiversity across both natural habitats and human-modified land. Given the importance of bumblebees for pollinating wild plants [@Ollerton2017] and agricultural crops (notably apples, pears, melons, peppers, cucumbers, tomatoes, and many nuts and soft fruits [@Klein2007]), these changes are likely to have important effects on both natural ecosystems and on our ability to grow food. Mitigating further losses of bumblebee diversity, and potentially reversing past declines, will require strong mitigation of climate change combined with restoration of natural habitats. To predict future changes in biodiversity, including of bumblebees, we must account for the complex interaction of climate and land-use pressures that are currently affecting species.

<!--
```{r session_info, echo=FALSE,reulst=TRUE,eval=TRUE}
print(sessionInfo())
```
-->

# Data and Code Availability:

Code to run the analyses is available on GitHub ([https://github.com/timnewbold/BumblebeesLUClimStudy](https://github.com/timnewbold/BumblebeesLUClimStudy)). Data are available on FigShare ([https://figshare.com/s/5e88f431142bc8fc454a](https://figshare.com/s/5e88f431142bc8fc454a)) - temporary link for peer review.

# Acknowledgments

This research was supported by a Royal Society International Exchanges grant to TN and JK (IE161031), UK Natural Environment Research Council grants to TN (NE/R010811/1 and NE/V006533/1) and a Royal Society University Research Fellowship to TN (UF150526). The authors declare no competing interests.

# References
